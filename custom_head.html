<meta content='width=device-width, initial-scale=1' name='viewport'/>

<link rel="stylesheet" href="/tema/viomagz.css"/>
<style>
  #blog-pager-newer-link, #blog-pager-older-link {display:none}
</style>
<style>
/* Tombol non-fixed, tampil setelah potongan konten */
      
.sticky-next-button {
  display: block;
  width: 100%;
  background-color: #007bff;
  color: white;
  padding: 16px;
  font-size: 18px;
  text-align: center;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
  margin-top: 20px;
}
.sticky-next-button:hover {
  background-color: #0056b3;
}
</style>

<script type='text/javascript'>
function initContentTruncation() {
  const charsToDisplay = 4000;
  const summaryText = &#39;Tampilkan Seluruh Cerita&#39;;

  const selfClosingTags = [&#39;img&#39;,&#39;br&#39;,&#39;hr&#39;,&#39;input&#39;,&#39;link&#39;,&#39;meta&#39;,&#39;area&#39;,&#39;base&#39;,&#39;col&#39;,&#39;embed&#39;,&#39;keygen&#39;,&#39;param&#39;,&#39;source&#39;,&#39;track&#39;,&#39;wbr&#39;];

  function fixHtmlCut(htmlString, cutIndex) {
    const tagRegex = /&lt;\/?([a-z][a-z0-9]*)\b[^&gt;]*&gt;/gi;
    let match, currentOpenTags = [];
    // Cegah pemotongan di tengah entitas HTML
let safeCutIndex = cutIndex;
while (htmlString[safeCutIndex - 1] === &#39;&amp;&#39; || /&amp;[a-zA-Z0-9#]{0,5}$/.test(htmlString.substring(safeCutIndex - 6, safeCutIndex))) {
  safeCutIndex--;
}

const cutHtml = htmlString.substring(0, safeCutIndex);
const remainingHtml = htmlString.substring(safeCutIndex);

while ((match = tagRegex.exec(cutHtml)) !== null) {
      const tagName = match[1].toLowerCase();
      if (match[0].startsWith(&#39;&lt;/&#39;)) {
        const index = currentOpenTags.indexOf(tagName);
        if (index &gt; -1) currentOpenTags.splice(index, 1);
      } else if (!selfClosingTags.includes(tagName)) {
        currentOpenTags.push(tagName);
      }
    }

    let closeTags = &#39;&#39;;
    for (let i = currentOpenTags.length - 1; i &gt;= 0; i--) {
      closeTags += &#39;&lt;/&#39; + currentOpenTags[i] + &#39;&gt;&#39;;
    }

    return {
      visible: cutHtml + closeTags,
      hidden: remainingHtml
    };
  }

  const postBodies = document.querySelectorAll(&#39;.post-body, .entry-content&#39;);
postBodies.forEach((postBody) =&gt; {
  if (!postBody) return;
  if (postBody.innerHTML.length &lt; charsToDisplay) return;

const originalContent = postBody.innerHTML;
    const fixedParts = fixHtmlCut(originalContent, charsToDisplay);
    const visibleContent = fixedParts.visible;
    const hiddenContent = fixedParts.hidden;

    const details = document.createElement(&#39;details&#39;);
details.style.width = &#39;100%&#39;;

const summary = document.createElement(&#39;summary&#39;);
summary.style.display = &#39;none&#39;;
details.appendChild(summary);

const hiddenDiv = document.createElement(&#39;div&#39;);
hiddenDiv.style.paddingTop = &#39;10px&#39;;
hiddenDiv.innerHTML = hiddenContent;
details.appendChild(hiddenDiv);


    const button = document.createElement(&#39;button&#39;);
    button.textContent = summaryText;
    button.className = &#39;sticky-next-button&#39;;

    // Tambahkan konten yang terlihat, lalu tombol, lalu tag details
    postBody.innerHTML = visibleContent;
    postBody.appendChild(button);
    postBody.appendChild(details);

button.addEventListener(&#39;click&#39;, () =&gt; {
      details.open = true;
      button.remove();
    });

    details.addEventListener(&#39;toggle&#39;, () =&gt; {
      if (details.open &amp;&amp; postBody.contains(button)) {
        button.remove();
      }
    });
  });
}

if (&#39;requestIdleCallback&#39; in window) {
  requestIdleCallback(initContentTruncation);
} else {
  window.addEventListener(&#39;load&#39;, initContentTruncation);
}
</script>
<script src="/tema/anomali.js"></script>

